<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NRL React Bot</title>
  <style>
    body { background:#000; color:#fff; font-family:sans-serif; text-align:center; padding:32px 16px; }
    h1 { margin:0 0 10px; }
    .btn { padding:14px 22px; font-size:16px; border:0; border-radius:12px; cursor:pointer; background:#0ea5e9; color:#fff; }
    .btn:disabled { opacity:.6; cursor:not-allowed; }
    .box { max-width:700px; margin:16px auto; text-align:left; padding:14px 16px; border-radius:12px; }
    .heard { background:#121212; border:1px solid #2a2a2a; min-height:64px; white-space:pre-wrap; }
    .reaction { background:#1e1e1e; border:1px solid #3a3a3a; font-style:italic; }
    .support { margin-top:8px; opacity:.8; }
    #face { font-size:60px; margin-top:18px; }
    #eyes { display:flex; justify-content:center; gap:60px; margin-bottom:8px; }
    .eye { font-size:50px; }
    #mouth { font-size:60px; display:inline-block; transform-origin:center; }
    .talking { animation:talk .28s infinite; }
    @keyframes talk { 0%{transform:scaleY(1)} 50%{transform:scaleY(.35)} 100%{transform:scaleY(1)} }
    code { background:#111; padding:2px 6px; border-radius:6px; }
  </style>
</head>
<body>
  <h1>ğŸ‰ NRL React Bot</h1>
  <p>Say <b>â€œHey React Bot â€¦â€</b> + your take. Pause â†’ get roasted ğŸ”¥</p>

  <button id="enable" class="btn">Enable Mic & Voice</button>
  <div id="status" class="support"></div>

  <div id="heard" class="box heard">ğŸ¤ Waitingâ€¦ click â€œEnable Mic & Voiceâ€ first.</div>
  <div id="reaction" class="box reaction" style="display:none;"></div>

  <!-- Face -->
  <div id="face">
    <div id="eyes"><div class="eye">ğŸ‘ï¸</div><div class="eye">ğŸ‘ï¸</div></div>
    <div id="mouth">ğŸ‘„</div>
  </div>

  <script>
    // --- Reactions (paste your huge list here if you want) ---
    const REACTIONS = [
"That take's weaker than the Warriorsâ€™ defence after a beer break.",
  "This sounds like a Raiders fan after a loss. Stop lying to yourself.",
  "Even the Broncos would drop that take after a pre-season trial.",
  "Your take is like the Tigersâ€™ finals hopes â€” non-existent.",
  "Thatâ€™s the sort of take a Newcastle fan would say after 3 beers.",
  "Is that your footy knowledge or just the sound of a hornetâ€™s nest?",
  "You talk more rubbish than a Manly fan after a loss.",
  "Bro, you couldâ€™ve at least *tried* to get this take right.",
  "I havenâ€™t seen this much delusion since the Bulldogsâ€™ last premiership win.",
  "Did a Parra fan write that or was it just their hopes?",
  "This take is more cooked than a Cowboys' away game.",
  "Iâ€™ve seen more passion in a pre-season trial match.",
  "Is this the take you give your mates after losing the footy tipping comp?",
  "That takeâ€™s got less support than the Dolphins in 2023.",
  "You're the reason we need a challenge system in real life.",
  "Bro, that takeâ€™s colder than a Melbourne winter.",
  "Even the NRL refs couldnâ€™t make a call that bad.",
  "You might wanna pass that one to the Dragons for review. They know bad takes.",
  "Thatâ€™s like picking the Cowboys to make the top 4 every year.",
  "You just dropped a bomb more explosive than a Broncosâ€™ season collapse.",
  "Bro, thatâ€™s the kind of take you hear after someoneâ€™s been hit by a tackle.",
  "Even the Knights wouldn't take that opinion seriously.",
  "Thatâ€™s like calling the Rabbitohs the real winners of every grand final.",
  "Is this a take or a cry for help? I need answers.",
  "Thatâ€™s like a Manly fan trying to explain why theyâ€™re the best team in the NRL.",
  "That takeâ€™s more hopeless than a Gold Coast season review.",
  "This is the kind of take that makes you a meme on the NRL subreddit.",
  "Bro, that was less hot than a Bulldogsâ€™ attack after round 5.",
  "Youâ€™ve just made every team in the NRL laugh in unison.",
  "Thatâ€™s the kind of take that makes you banned from the footy club.",
  "Bro, thatâ€™s a mistake bigger than a Titans season review.",
  "You talk like a Warriors fan who just won a game. Settle down.",
  "That takeâ€™s about as accurate as a Manly fan trying to pick a winner.",
  "Your takeâ€™s more cooked than a Canberra penalty in the finals.",
  "Bro, that takeâ€™s just straight-up pain for every NRL fan in existence.",
  "That sounds like something you'd hear in a Roosters supporterâ€™s delusional dream.",
  "Iâ€™d rather listen to the NRLâ€™s official highlights than that.",
  "That take's got more flaws than the Bulldogs' attack in the past decade.",
  "You sound like a Parra fan after theyâ€™ve lost a final.",
  "Thatâ€™s more ridiculous than the Knights calling themselves premiership contenders.",
  "Iâ€™d rather watch a Raiders fan explain how they almost won than hear that.",
  "This take is worse than the Tigers' defence after a weekend off.",
  "Iâ€™d rather be stuck in a stadium with a Manly fan than hear that take again.",
  "Bro, this is like the Storm's salary cap â€” it just doesnâ€™t make sense.",
  "Thatâ€™s like a Broncos fan claiming they invented the sport. Please stop.",
  "This take's got more issues than a Bulldogs recruitment strategy.",
  "You just compared your team to a premiership contender? Câ€™mon, mate.",
  "That takeâ€™s like the Titansâ€™ finals hopes: completely shattered and delusional.",
  "This roast hits harder than the Raiders' tackle technique.",
  "Bro, this take is more out of place than a Sharksâ€™ premiership ring.",
  "That take's got less structure than the Tigers' attack.",
  "Your opinionâ€™s more inconsistent than the NRL ref calls.",
  "Bro, even the Warriors would reject that take for being too negative.",
  "Iâ€™ve seen better analysis from a kid playing SuperCoach in their lunch break.",
  "Thatâ€™s like picking the Cowboys to make the top 4 every year.",
  "You just dropped a bomb more explosive than a Broncosâ€™ season collapse.",
  "Bro, thatâ€™s the kind of take you hear after someoneâ€™s been hit by a tackle.",
  "Even the Knights wouldn't take that opinion seriously.",
  "Thatâ€™s like calling the Rabbitohs the real winners of every grand final.",
  "Is this a take or a cry for help? I need answers.",
  "Thatâ€™s like a Manly fan trying to explain why theyâ€™re the best team in the NRL.",
  "That takeâ€™s more hopeless than a Gold Coast season review.",
  "This is the kind of take that makes you a meme on the NRL subreddit.",
  "Bro, that was less hot than a Bulldogsâ€™ attack after round 5.",
  "Youâ€™ve just made every team in the NRL laugh in unison.",
  "Thatâ€™s the kind of take that makes you banned from the footy club.",
  "Bro, thatâ€™s a mistake bigger than a Titans season review.",
  "You talk like a Warriors fan who just won a game. Settle down.",
  "That takeâ€™s about as accurate as a Manly fan trying to pick a winner.",
  "Your takeâ€™s more cooked than a Canberra penalty in the finals.",
  "Bro, that takeâ€™s just straight-up pain for every NRL fan in existence.",
  "That sounds like something you'd hear in a Roosters supporterâ€™s delusional dream.",
  "Iâ€™d rather listen to the NRLâ€™s official highlights than that.",
  "That take's got more flaws than the Bulldogs' attack in the past decade.",
  "You sound like a Parra fan after theyâ€™ve lost a final.",
  "Thatâ€™s more ridiculous than the Knights calling themselves premiership contenders.",
  "Iâ€™d rather watch a Raiders fan explain how they almost won than hear that.",
  "This take is worse than the Tigers' defence after a weekend off.",
  "Iâ€™d rather be stuck in a stadium with a Manly fan than hear that take again.",
  "Bro, this is like the Storm's salary cap â€” it just doesnâ€™t make sense.",
  "Thatâ€™s like a Broncos fan claiming they invented the sport. Please stop.",
  "This take's got more issues than a Bulldogs recruitment strategy.",
  "You just compared your team to a premiership contender? Câ€™mon, mate.",
  "That takeâ€™s like the Titansâ€™ finals hopes: completely shattered and delusional.",
  "This roast hits harder than the Raiders' tackle technique.",
  "Bro, this take is more out of place than a Sharksâ€™ premiership win.",
  "Mate, Iâ€™ve seen better decisions from a busted bunker review.",
  "This opinionâ€™s got more holes than the Tigersâ€™ backline.",
  "You talking footy is like a prop trying to kick a field goal. Painful.",
  "Youâ€™re chatting like a bloke who still thinks the Cowboys are top 4.",
  "You sound like a Raiders fan in March â€” way too confident, mate.",
  "Honestly, even the Bulldogs' attack makes more sense than that.",
  "Feels like you wrote that after a few too many at the Leagues Club.",
  "Bro, your footy IQâ€™s dropping faster than the Dragons on the ladder.",
  "That's something only a Parramatta supporter could believe.",
  "I've heard better gameplans yelled from the sideline at U6s.",
  "You talking strategy? Might as well get a cat to coach.",
  "This is exactly why the Warriors get roasted every season.",
  "Even Newcastle's rebuild looks more promising than that thought.",
  "You're giving off strong 'we nearly made the finals' energy.",
  "Are you applying for Tigers coach or just talking rubbish for free?",
  "Feels like youâ€™re still celebrating that trial win in January.",
  "Youâ€™ve got more excuses than a Roosters fan after a bad season.",
  "This is the same energy as a Sharks fan bragging in May.",
  "You should frame that comment and hang it in the Bulldogs HQ.",
  "This chat's moving backwards faster than the Knightsâ€™ rebuild.",
  "You're sounding like Souths after round 5 â€” pure delusion.",
  "Did you come up with that during the halftime toilet break?",
  "Mate, even the refs would call that opinion a howler.",
  "Youâ€™re running your mouth like the Eels after one good win.",
  "Might as well hand you a jersey with 'Benchwarmer' on the back.",
  "That statementâ€™s falling apart quicker than the Raiders defence.",
  "You sound like a bloke who picked Tigers for top 8 unironically.",
  "Are you coaching the Titans or just giving them ideas?",
  "This has less structure than a busted scrum at park footy.",
  "Youâ€™re throwing more shade than a Broncos fan after finals.",
  "Your chatâ€™s got more missed tackles than a Sunday arvo pub team.",
  "You're just adding fuel to a fire that was already out.",
  "Might want to take a spell, youâ€™re gassed worse than a prop in golden point.",
  "This convoâ€™s making less sense than the NRL draw every year.",
  "Youâ€™re about as reliable as a Knights winning streak.",
  "Feels like you wrote that during a 60-0 flogging.",
  "Keep talking, you might get signed by the Dragons.",
  "Youâ€™re making less sense than a Manly fan bragging about 2008.",
  "I've seen more solid arguments from a bloke three beers deep.",
  "Sounds like youâ€™re still living off 2015 memories, mate.",
  "You're talking like someone who thinks Origin is won in January.",
  "That ideaâ€™s falling apart quicker than a Parra finals run.",
  "Someone call the Bunker, this bloke needs reviewing.",
  "Mate, that logicâ€™s been on the piss since Mad Monday.",
  "Even the Dolphins would leave you out of the 17.",
  "Youâ€™ve got more spin than a fullback under a bomb.",
  "Feels like you got that opinion off Facebook comments.",
  "Bro, you're confusing effort with actual results again.",
  "That takeâ€™s better than a dummy half break straight through the line.",
  "Mate, you just nailed it like a fullback under a high ball.",
  "Thatâ€™s the kind of take that makes me want to jump out of my seat.",
  "Your analysis just hit harder than a big hit from the back row.",
  "Bro, thatâ€™s more accurate than a halfbackâ€™s game-winning kick.",
  "That callâ€™s as clean as a try-saving tackle in the 79th minute.",
  "Thatâ€™s a take thatâ€™ll make the NRL highlights reel for sure.",
  "You just broke it down like youâ€™ve been watching replays for days.",
  "Youâ€™ve got more footy IQ than the whole coaching staff combined.",
  "Thatâ€™s a classic NRL moment in the making right there.",
  "Youâ€™ve got more insight than a team meeting before finals.",
  "That takeâ€™s smoother than a halfbackâ€™s skip pass to the winger.",
  "Thatâ€™s the kind of analysis youâ€™d hear from a veteran like Joey Johns.",
  "Mate, youâ€™ve read the game like youâ€™re in the sheds with the coach.",
  "Thatâ€™s a take that even the players would give a nod to.",
  "Thatâ€™s more solid than a front-rowerâ€™s defence on the try line.",
  "Youâ€™ve just broken it down like a pro commentator during a grand final.",
  "Thatâ€™s sharper than a wingerâ€™s step when theyâ€™re in space.",
  "Thatâ€™s a take that deserves its own highlight reel.",
  "Youâ€™re talking footy like itâ€™s a second language â€” fluent and flawless.",
  "Thatâ€™s as sharp as a dummy from a halfback in the red zone.",
  "Youâ€™ve nailed that like a winger scoring in the corner after a break.",
  "Mate, that take is like a perfect kick-off: right on the money.",
  "Thatâ€™s smarter than an Origin team selection.",
  "Bro, you just turned that take into a try assist.",
  "Thatâ€™s like having a seasoned veteran on the field â€” spot on.",
  "You just broke down the game like youâ€™ve been analyzing it for years.",
  "Thatâ€™s as clean as a playmakerâ€™s cut-out pass under pressure.",
  "Mate, if footy takes were tries, youâ€™d be leading the competition.",
  "Thatâ€™s a take as smooth as a fullbackâ€™s counter-attack from the 20m.",
  "Youâ€™ve nailed it like a field goal in the dying seconds of a tied match.",
  "Thatâ€™s as solid as a middle forwardâ€™s effort to punch through the defence.",
  "You just called that like youâ€™re already in the commentary box.",
  "Thatâ€™s more precise than a back-rowerâ€™s tackle technique.",
  "Mate, youâ€™ve got the vision of a halfback in the dying minutes of a final.",
  "Thatâ€™s got more finesse than a winger chasing a kick from the 40m.",
  "Bro, thatâ€™s as insightful as a coachâ€™s post-game breakdown.",
  "That takeâ€™s got more impact than a last-minute try on the buzzer.",
  "You just read the game like a centre under the high ball.",
  "Thatâ€™s a take that would make any coach pause and rethink.",
  "Thatâ€™s as clean as a conversion attempt from the sideline.",
  "Mate, youâ€™ve got more footy smarts than half the starting line-ups.",
  "Youâ€™ve dissected that play like a video ref in slow motion.",
  "That take is like a well-timed intercept pass in the dying moments.",
  "Bro, you just set up a try with that analysis!",
  "Thatâ€™s smarter than a back-rower reading the ball on the edge.",
  "Youâ€™ve broken that down like a front-rower running it in at full speed.",
  "That take is as smooth as a well-executed switch play.",
  "Mate, youâ€™ve got more knowledge than a fullbackâ€™s positioning on the last tackle.",
  "Youâ€™ve just outclassed most of the analysts in the game with that one.",
  "Thatâ€™s a take that deserves its own highlight package!",
  "This rage quit is like the Leaguie seeing roosters get defeated. As beautiful as friendship.",
  "You just nailed that analysis like a hooker hitting the mark with a quick tap.",
    ];

    // --- Elements ---
    const enableBtn  = document.getElementById('enable');
    const statusEl   = document.getElementById('status');
    const heardEl    = document.getElementById('heard');
    const reactEl    = document.getElementById('reaction');
    const mouthEl    = document.getElementById('mouth');

    // --- Feature detection ---
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const hasRecognition = !!SpeechRecognition;
    const hasSynthesis = 'speechSynthesis' in window;

    // Show support status
    (function showSupport() {
      const items = [];
      items.push(`Speech Recognition: ${hasRecognition ? 'âœ…' : 'âŒ (use Chrome/Edge)'}`);
      items.push(`Speech Synthesis: ${hasSynthesis ? 'âœ…' : 'âŒ'}`);
      items.push(`Secure context (HTTPS): ${window.isSecureContext ? 'âœ…' : 'âŒ'}`);
      statusEl.textContent = items.join(' â€¢ ');
    })();

    // --- Utilities ---
    const wait = (ms) => new Promise(r=>setTimeout(r, ms));
    const pick = (arr) => arr[Math.floor(Math.random() * arr.length)];
    const norm = (s) => s.toLowerCase().replace(/[^\w\s']/g,'').trim(); // basic normalize

    // Unlock audio & mic by user gesture, then loop
    enableBtn.addEventListener('click', async () => {
      enableBtn.disabled = true;
      heardEl.textContent = "ğŸ¤ Mic requestedâ€¦ allow the permission popup if prompted.";

      // Pre-warm speech synthesis (autoplay policies)
      if (hasSynthesis) {
        try {
          const u = new SpeechSynthesisUtterance("Ready.");
          u.volume = 0; // silent unlock
          u.rate = 1;
          u.lang = "en-AU";
          window.speechSynthesis.speak(u);
        } catch {}
      }

      // Ask for mic permission at least once so the browser shows the prompt
      try {
        await navigator.mediaDevices.getUserMedia({ audio: true });
      } catch (e) {
        heardEl.textContent = "ğŸš« Mic permission denied. Please allow the mic and click again.";
        enableBtn.disabled = false;
        return;
      }

      if (!hasRecognition) {
        heardEl.textContent =
          "âš ï¸ Your browser doesnâ€™t support speech recognition. Use Chrome or Edge.\n" +
          "Alternative: wire this page to a server STT (e.g., Whisper/Vosk) via fetch/WebSocket.";
        enableBtn.disabled = false;
        return;
      }

      heardEl.textContent = "âœ… Mic enabled. Say â€œHey React Bot â€¦â€ whenever you like.";
      loopListen(); // start infinite loop
    });

    // Main loop: listen once -> maybe roast -> repeat
    async function loopListen() {
      while (true) {
        const transcript = await listenOnce();     // waits for a single utterance
        if (!transcript) { continue; }

        // show what we heard
        heardEl.textContent = "ğŸ‘‚ Heard: " + transcript;

        // wake phrase check
        const cleaned = norm(transcript);
        if (cleaned.startsWith("hey react")) {
          // extract what the user said after the wake phrase
          const after = transcript.slice(transcript.toLowerCase().indexOf("hey react bot") + "hey react bot".length).trim();
          await roast(after || transcript);
        }

        // small breather before next listen
        await wait(150);
      }
    }

    // Listen for one phrase (Chrome/Edge webkitSpeechRecognition is most reliable non-API way)
    function listenOnce() {
      return new Promise((resolve) => {
        const rec = new SpeechRecognition();
        rec.lang = "en-AU";
        rec.interimResults = true;   // show live text
        rec.maxAlternatives = 1;
        rec.continuous = false;      // one phrase, then end on its own pause

        let interim = "";
        let finalText = "";

        rec.onresult = (e) => {
          interim = "";
          for (let i = e.resultIndex; i < e.results.length; i++) {
            const chunk = e.results[i][0].transcript;
            if (e.results[i].isFinal) {
              finalText += chunk;
            } else {
              interim += chunk;
            }
          }
          // live update
          const live = (finalText + " " + interim).trim();
          if (live) heardEl.textContent = "ğŸ‘‚ Heard: " + live;
        };

        rec.onerror = () => resolve("");
        rec.onend   = () => resolve((finalText || interim || "").trim());

        try {
          rec.start();
        } catch {
          // rare race; resolve quickly to keep loop going
          resolve("");
        }
      });
    }

    async function roast(userSaid) {
      // Pick roast
      const line = pick(REACTIONS);

      // Show on screen
      reactEl.style.display = "block";
      reactEl.textContent = `You said:\nâ€œ${userSaid}â€\n\nReact Bot:\nâ€œ${line}â€`;

      // Talk with mouth animation
      mouthEl.classList.add("talking");
      if (hasSynthesis) {
        const u = new SpeechSynthesisUtterance(line);
        u.lang = "en-AU";
        u.rate = 0.95;
        u.onend = () => mouthEl.classList.remove("talking");
        try { window.speechSynthesis.speak(u); }
        catch { mouthEl.classList.remove("talking"); }
      } else {
        // fallback: stop mouth after a short moment
        await wait(1200);
        mouthEl.classList.remove("talking");
      }
    }
  </script>
</body>
</html>
