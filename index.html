<script>
  const reactions = [
    "That take's weaker than the Warriors’ defence after a beer break.",
    "Even the Broncos would drop that take after a pre-season trial.",
    "Your take is like the Tigers’ finals hopes — non-existent.",
    "You talk more rubbish than a Manly fan after a loss.",
    "Bro, that’s the kind of take you hear after someone’s been hit by a tackle.",
    "That take’s about as accurate as a Manly fan trying to pick a winner.",
    "This roast hits harder than the Raiders' tackle technique.",
    "That’s more ridiculous than the Knights calling themselves premiership contenders.",
    "This is the kind of take that makes you a meme on the NRL subreddit.",
    "That take's got more flaws than the Bulldogs' attack in the past decade.",
    "I’d rather listen to the NRL’s official highlights than that.",
    "Even the NRL refs couldn’t make a call that bad.",
    "That’s like a Broncos fan claiming they invented the sport. Please stop.",
    "This take's more out of place than a Sharks’ premiership ring."
  ];

  const status = document.getElementById("status");
  const reactionDiv = document.getElementById("reaction");
  const mouth = document.getElementById("mouth");

  function setMouthTalking(isTalking) {
    mouth.style.animation = isTalking ? "talk 0.3s infinite" : "talk 0s";
  }

  function startListening() {
    if (!('webkitSpeechRecognition' in window || 'SpeechRecognition' in window)) {
      alert("Sorry, your browser doesn't support voice recognition 😢");
      return;
    }

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = new SpeechRecognition();
    recognition.lang = 'en-AU';
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    status.innerText = "Listening... 🎙️";
    reactionDiv.style.display = "none";

    // Start mouth moving while user is talking
    setMouthTalking(true);

    recognition.start();

    recognition.onresult = (event) => {
      const take = event.results[0][0].transcript;
      status.innerText = `You said: "${take}"`;

      const randomReaction = reactions[Math.floor(Math.random() * reactions.length)];
      reactionDiv.innerText = `"${randomReaction}"`;
      reactionDiv.style.display = "block";

      speakReaction(randomReaction);
    };

    recognition.onerror = (event) => {
      status.innerText = "Error: " + event.error;
      setMouthTalking(false);
    };

    recognition.onend = () => {
      // Stop mouth after you're done talking
      setMouthTalking(false);
    };
  }

  function speakReaction(text) {
    const synth = window.speechSynthesis;
    const utter = new SpeechSynthesisUtterance(text);
    utter.lang = 'en-AU';
    utter.pitch = 1;
    utter.rate = 1;

    utter.onstart = () => setMouthTalking(true);
    utter.onend = () => setMouthTalking(false);

    synth.speak(utter);
  }
</script>
